# Source Code Modifications and Alignment (Spine Core Logic)

This document records the deep customizations made to the official Spine Runtime (C++) source code in this SDK. These modifications ensure that exported assets perfectly align with the underlying logic of the original ENDER LILIES game.

## 1. Asset Organization: Multi-Object Single Package Structure
**Related Commit**: [`c099e628`](https://github.com/f14XuanLv/EnderLilies-More-Skins/commit/c099e6285495ca406a28c50b730074519c18e3a9)

**Modified Files**:
- [`SpineAtlasImportFactory.cpp`](/Plugins/SpinePlugin/Source/SpineEditorPlugin/Private/SpineAtlasImportFactory.cpp)
- [`SpineSkeletonImportFactory.cpp`](/Plugins/SpinePlugin/Source/SpineEditorPlugin/Private/SpineSkeletonImportFactory.cpp)
- [`SpineSkeletonDataAsset.h`](/Plugins/SpinePlugin/Source/SpinePlugin/Public/SpineSkeletonDataAsset.h)

*   **Technical Background**: The official plugin stores Atlas and Skeleton separately in different `.uasset` files by default. However, the original game encapsulates both within the same Package container.
*   **Implementation**: Force retrieval of `InParent->GetOutermost()` (i.e., shared package container) in `FactoryCreateFile`.
*   **Result**: The asset structure after import (e.g., `p0007_Lily.uasset` internally contains both `-atlas` and `-data` objects) is completely consistent with the original game, solving reference path deviation issues.

## 2. Data Structure Extension: Lily-Specific Properties
**Related Commit**: [`c099e628`](https://github.com/f14XuanLv/EnderLilies-More-Skins/commit/c099e6285495ca406a28c50b730074519c18e3a9)

**Modified Files**:
- [`SpineSkeletonDataAsset.h`](/Plugins/SpinePlugin/Source/SpinePlugin/Public/SpineSkeletonDataAsset.h)

*   **Modifications**: Manually appended variables existing in the original C++ layer to the `USpineSkeletonDataAsset.h` class:
    *   `float DefaultScale`: Defaults to `1.196f`, ensuring Lily's correct physical size in the scene.
    *   `TArray<FString> DefaultSkins`: Used to store the default activated Spine skin layers.
*   **Result**: Assets generated by this SDK can be directly recognized by the game's C++ logic without requiring manual secondary configuration in Unreal Editor.

## 3. Import Automation: Lily Preset Auto-Population
**Related Commit**: [`3ba0effb`](https://github.com/f14XuanLv/EnderLilies-More-Skins/commit/3ba0effb0ab81cfad77bd064ed099975205e2c60)

**Modified Files**:
- [`SpineSkeletonImportFactory.cpp`](/Plugins/SpinePlugin/Source/SpineEditorPlugin/Private/SpineSkeletonImportFactory.cpp)

*   **Technical Implementation**: Added `SetupLilyDefaultProperties` helper function. When the system recognizes filenames conforming to the `p*_Lily` specification, it automatically executes:
    *   **26 MixData Mappings**: Automatically populates the complete set of animation mix times including `jump_up` -> `jump_apex` (ranging from 0s to 0.5s).
    *   **Skin Layer Alignment**: Automatically sets the default skin array to `["_common", "MainSkinName", "_Meat_Head_0"]`.
*   **Result**: Creators only need to import the original Spine file to instantly obtain dynamic feel and rendering hierarchy completely consistent with the original Lily.

## 4. Texture Import Optimization and Silent Processing
**Related Commit**: [`d3d874e0`](https://github.com/f14XuanLv/EnderLilies-More-Skins/commit/d3d874e0e6411b12e4c0af75077a1d026b069055)

**Modified Files**:
- [`SpineAtlasImportFactory.cpp`](/Plugins/SpinePlugin/Source/SpineEditorPlugin/Private/SpineAtlasImportFactory.cpp)
- [`SpineSkeletonImportFactory.cpp`](/Plugins/SpinePlugin/Source/SpineEditorPlugin/Private/SpineSkeletonImportFactory.cpp)

*   **Modifications**: Refactored the `resolveTexture` function.
    *   **Forced Rendering Properties**: Automatically disables `Mipmaps` (TMGS_NoMipmaps) and sets LOD group to `TEXTUREGROUP_Character` to ensure pixel/hand-drawn texture clarity.
    *   **Script Support**: Introduced `UAssetImportTask` with `bAutomated` enabled.
*   **Result**: Supports popup-free background batch import via Python scripts (Commandlet mode), greatly improving development environment build speed.

## 5. Removing 3.8.75 Version Hard Limit (Compatibility Patch)
**Related Commit**: [`2a940a78`](https://github.com/f14XuanLv/EnderLilies-More-Skins/commit/2a940a78a79f8c205c7068c38a75c7bb464aed28)

**Modified Files**:
- [`SkeletonBinary.cpp`](/Plugins/SpinePlugin/Source/SpinePlugin/Public/spine-cpp/src/spine/SkeletonBinary.cpp)
- [`SkeletonJson.cpp`](/Plugins/SpinePlugin/Source/SpinePlugin/Public/spine-cpp/src/spine/SkeletonJson.cpp)

*   **Background**: Spine officially hardcoded rejection logic for `3.8.75` assets in later 3.8 version Runtimes.
*   **Reason for Removal**: While `3.8.75` has widespread cracked versions leading to official blocking, for the modding community, this version has a large existing asset base and mature toolchain.
*   **Implementation**: Commented out version validation logic in `SkeletonBinary.cpp` and `SkeletonJson.cpp`.
*   **Result**: **Achieved backward compatibility with 3.8.75 assets**. This SDK believes creative freedom is more important than version restrictions, allowing creators to use the most popular community tools for mod development.

---

### Technical Summary
Through the above customizations to the underlying source code, this SDK achieves "full-path alignment" from asset file structure to runtime data logic. This allows developers to focus on artistic creation, while complex engine-related work is automatically handled by the SDK's underlying systems.